<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Craftpick Network — Site complet</title>
<style>
/* ---------- Reset & base ---------- */
*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,Arial,sans-serif}
:root{
  --bg1:#071024;--bg2:#061223;--muted:#9aa4b2;--glass:rgba(255,255,255,0.03);
  --accent1:#6366f1;--accent2:#ec4899;--success:#10b981
}
body{background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#e6eef8;min-height:100vh}
.container{max-width:1100px;margin:28px auto;padding:18px}
/* header */
.header{display:flex;justify-content:space-between;align-items:center;gap:12px}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:white;font-size:18px}
.brand h1{font-size:18px}
.brand p{color:var(--muted);font-size:12px}
/* nav */
nav{display:flex;gap:12px;align-items:center}
.link{padding:8px 12px;border-radius:10px;background:var(--glass);cursor:pointer}
.btn-primary{padding:8px 12px;border-radius:10px;background:linear-gradient(90deg,var(--accent1),var(--accent2));border:none;color:white;cursor:pointer}
/* layout */
.grid{display:grid;grid-template-columns:2fr 1fr;gap:18px;margin-top:18px}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:18px;border-radius:14px;border:1px solid rgba(255,255,255,0.02)}
.stat-grid{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.stat{flex:1;min-width:140px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)}
.small{font-size:13px;color:var(--muted)}
.arenas{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;margin-top:12px}
.arena{padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center}
/* modal */
.modal {position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.6)}
.modal .box{width:420px;background:#071225;padding:18px;border-radius:12px}
.modal.show{display:flex}
/* forms */
input,textarea,select{width:100%;padding:10px;margin-top:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit}
button{cursor:pointer}
.notify{position:fixed;right:20px;bottom:20px;background:#081022;padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);display:none}
/* responsive */
@media(max-width:900px){.grid{grid-template-columns:1fr}.logo{width:48px;height:48px}}
/* small helpers */
.row{display:flex;gap:10px;align-items:center}
.center{display:flex;align-items:center;justify-content:center}
.mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, monospace}
.section-title{font-size:18px;margin-bottom:8px}
.hidden{display:none}
</style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand">
        <div class="logo">CP</div>
        <div>
          <h1>Craftpick Network</h1>
          <p class="small">Un serveur, une révolution · 1.8.8</p>
        </div>
      </div>
      <nav>
        <div class="link" id="navHome">Accueil</div>
        <div class="link" id="navGames">Mini-Jeux</div>
        <div class="link" id="navVote">Vote</div>
        <div class="link" id="navShop">Boutique</div>
        <button class="btn-primary" id="btnConnect">Se connecter</button>
      </nav>
    </header>

    <main class="grid" id="mainGrid">
      <!-- Main card -->
      <section class="card" id="mainCard">
        <h2 class="section-title">Bienvenue sur Craftpick Network</h2>
        <p class="small">Rejoins-nous pour des parties rapides, compétitives et funs. IP: <span class="mono" id="serverIP">craftpick.fr</span></p>

        <div class="stat-grid">
          <div class="stat">
            <div class="small">Statut</div>
            <div id="statusValue">Chargement...</div>
            <div class="small" id="motd">—</div>
          </div>
          <div class="stat">
            <div class="small">Joueurs</div>
            <div id="playersValue">0 / 0</div>
            <div class="small">En temps réel</div>
          </div>
          <div class="stat">
            <div class="small">Durée moyenne</div>
            <div id="avgDuration">—</div>
            <div class="small">Arènes actives: <span id="activeArenas">—</span></div>
          </div>
        </div>

        <div style="margin-top:14px">
          <h3 class="small">Arènes populaires</h3>
          <div class="arenas" id="arenaList"></div>
        </div>

        <div style="margin-top:14px" class="row">
          <button class="link" id="btnLobby">Lobby</button>
          <button class="link" id="btnShop">Boutique</button>
          <button class="link" id="btnVote">Voter</button>
          <button class="link" id="btnRecruit">Recrutement</button>
        </div>

      </section>

      <!-- Aside -->
      <aside class="card">
        <div>
          <div class="small">IP</div>
          <div class="mono small" style="margin-top:8px;">craftpick.fr</div>
          <div style="margin-top:10px">
            <button class="link" id="copyIP">Copier l'IP</button>
            <button class="link" id="goLogin">Se connecter</button>
          </div>
        </div>

        <div style="margin-top:14px">
          <div class="small">Stats globales</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <div class="card" style="padding:8px;flex:1;text-align:center">Parties<br/><strong id="totalGames">—</strong></div>
            <div class="card" style="padding:8px;flex:1;text-align:center">Arènes<br/><strong id="totalArenas">—</strong></div>
          </div>
        </div>
      </aside>
    </main>

    <footer style="margin-top:20px;text-align:center;color:var(--muted)">
      © <span id="year"></span> Craftpick Network — IP: <span class="mono">craftpick.fr</span>
    </footer>
  </div>

  <!-- Modal (login/register/profile) -->
  <div class="modal" id="modal">
    <div class="box" id="modalBox"></div>
  </div>

  <div class="notify" id="notify">Message</div>

<script>
/*
  FRONTEND: Fully contained single-file.
  - To use real backend: set API_BASE to your API URL (no trailing slash), e.g. https://api.mydomain.com
  - If API_BASE is null, the UI uses simulated responses.
*/
const API_BASE = null; // <<<<<< set your backend url here (string) to enable real mode
const loginPage = "https://louisoff84.github.io/craftpick.fr/login-register.html"; // fallback

// Utilities
function showNotify(msg){ const n=document.getElementById('notify'); n.textContent=msg; n.style.display='block'; setTimeout(()=>n.style.display='none',2400); }
function el(id){ return document.getElementById(id); }
el('year').textContent = new Date().getFullYear();

// Mock / API functions
async function api_getStatus(){
  if(!API_BASE) return mockStatus();
  try{
    const r = await fetch(API_BASE + '/api/status');
    return await r.json();
  }catch(e){ return {online:false,players:0,maxPlayers:0,motd:'Erreur API'}; }
}
async function api_getStats(){
  if(!API_BASE) return mockStats();
  try{
    const r = await fetch(API_BASE + '/api/stats');
    return await r.json();
  }catch(e){ return {avgDuration:'—',arenas:0,totalGames:0}; }
}

// Mock data
function mockStatus(){ const online = Math.random() > 0.05; const players = online? Math.floor(Math.random()*80):0; return {online,players,max:200,motd:'§aCraftpick Network — Mini-jeux 1.8.8'} }
function mockStats(){ return {avgDuration:'12m 34s',arenas:12,totalGames:18452} }

// UI renderers
async function updateStatus(){
  const s = await api_getStatus();
  el('statusValue').textContent = s.online? 'En ligne' : 'Hors-ligne';
  el('motd').textContent = s.motd || '';
  el('playersValue').textContent = `${s.players} / ${s.max}`;
}
async function updateStats(){
  const st = await api_getStats();
  el('avgDuration').textContent = st.avgDuration;
  el('activeArenas').textContent = st.arenas;
  el('totalGames').textContent = st.totalGames.toLocaleString('fr-FR');
  el('totalArenas').textContent = st.arenas;
}
function renderArenas(){
  const examples = [{name:'Île de fer',mode:'BedWars',players:8},{name:'Forteresse',mode:'BedWars',players:8},{name:'Nautilus',mode:'Duels',players:4},{name:'Cité céleste',mode:'BedWars',players:12}];
  const wrap = el('arenaList'); wrap.innerHTML='';
  examples.forEach(a=>{
    const d = document.createElement('div'); d.className='arena';
    d.innerHTML = `<div><strong>${a.name}</strong><div class="small">${a.mode} · ${a.players} joueurs</div></div><div><button class="link join" data-arena="${a.name}">Rejoindre</button></div>`;
    wrap.appendChild(d);
  });
}

// Modal UI (login/register/profile)
const modal = el('modal'), modalBox = el('modalBox');
function openModal(html){ modalBox.innerHTML = html; modal.classList.add('show'); modal.style.display='flex'; attachModalHandlers(); }
function closeModal(){ modal.classList.remove('show'); modal.style.display='none'; }
modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });

function attachModalHandlers(){
  // login form
  const loginForm = document.getElementById('loginForm');
  if(loginForm) loginForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const form = new FormData(loginForm);
    const payload = {user: form.get('user'), pass: form.get('pass')};
    if(!API_BASE){
      closeModal(); showNotify('Connecté — simulation'); localStorage.setItem('cp_user', payload.user); renderLogged();
      return;
    }
    // real login
    try{
      const r = await fetch(API_BASE + '/api/auth/login', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
      const data = await r.json();
      if(r.ok){ localStorage.setItem('cp_token', data.token); localStorage.setItem('cp_user', payload.user); closeModal(); showNotify('Connecté'); renderLogged(); }
      else showNotify(data.message || 'Erreur connexion');
    }catch(err){ showNotify('Erreur réseau'); }
  });

  // register form
  const regForm = document.getElementById('registerForm');
  if(regForm) regForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const f = new FormData(regForm);
    const payload = { user:f.get('user'), email:f.get('email'), pass:f.get('pass'), pass2:f.get('pass2')};
    if(payload.pass !== payload.pass2){ showNotify('Les mots de passe ne correspondent pas'); return; }
    if(!API_BASE){
      closeModal(); showNotify('Compte créé — simulation'); localStorage.setItem('cp_user', payload.user); renderLogged(); return;
    }
    try{
      const r = await fetch(API_BASE + '/api/auth/register', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
      const data = await r.json();
      if(r.ok){ closeModal(); showNotify('Compte créé'); localStorage.setItem('cp_token', data.token); localStorage.setItem('cp_user', payload.user); renderLogged(); }
      else showNotify(data.message || 'Erreur inscription');
    }catch(err){ showNotify('Erreur réseau'); }
  });

  // simple buttons in modal (toggle)
  const toReg = document.getElementById('toRegister'); if(toReg) toReg.addEventListener('click', ()=> showRegister());
  const toLog = document.getElementById('toLogin'); if(toLog) toLog.addEventListener('click', ()=> showLogin());
  const closeBtn = document.getElementById('modalClose'); if(closeBtn) closeBtn.addEventListener('click', closeModal);
}

// Modal screens
function showLogin(){
  openModal(`
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><strong>Connexion</strong><button id="modalClose" class="link">Fermer</button></div>
    <form id="loginForm">
      <input name="user" placeholder="Pseudo" required>
      <input name="pass" placeholder="Mot de passe" type="password" required>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn-primary" type="submit">Se connecter</button>
        <button type="button" class="link" id="toRegister">S'inscrire</button>
      </div>
    </form>`);
}

function showRegister(){
  openModal(`
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><strong>Inscription</strong><button id="modalClose" class="link">Fermer</button></div>
    <form id="registerForm">
      <input name="user" placeholder="Pseudo" required>
      <input name="email" placeholder="Email (optionnel)" type="email">
      <input name="pass" placeholder="Mot de passe" type="password" required>
      <input name="pass2" placeholder="Confirme le mot de passe" type="password" required>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn-primary" type="submit">Créer</button>
        <button type="button" class="link" id="toLogin">Connexion</button>
      </div>
    </form>`);
}

function showProfile(){
  const user = localStorage.getItem('cp_user') || 'Invité';
  openModal(`
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><strong>Profil</strong><button id="modalClose" class="link">Fermer</button></div>
    <div>
      <div class="small">Pseudo</div><div class="mono" style="margin-top:6px">${user}</div>
      <div style="margin-top:10px" class="small">Actions</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="link" id="btnLogout">Se déconnecter</button>
        <button class="link" id="btnProfileStats">Mes stats</button>
      </div>
    </div>`);
  // attach
  document.getElementById('btnLogout').addEventListener('click', ()=>{
    localStorage.removeItem('cp_token'); localStorage.removeItem('cp_user'); closeModal(); showNotify('Déconnecté'); renderLogged();
  });
  document.getElementById('btnProfileStats').addEventListener('click', ()=> {
    closeModal(); showNotify('Stats du profil — simulation'); // placeholder
  });
}

// Logged rendering: change connect button
function renderLogged(){
  const btn = el('btnConnect');
  const user = localStorage.getItem('cp_user');
  if(user){ btn.textContent = user; btn.removeEventListener('click', handleConnect); btn.addEventListener('click', showProfile); }
  else { btn.textContent = 'Se connecter'; btn.removeEventListener('click', showProfile); btn.addEventListener('click', handleConnect); }
}

// click handlers that redirect to login page if not logged
function guardOrRedirect(target){
  if(localStorage.getItem('cp_user')) { showNotify('Redirection vers ' + target + ' — simulation'); /* open real page when implemented */ }
  else window.location.href = "${loginPage}";
}

// initial click handlers
function handleConnect(){ if(API_BASE) showLogin(); else window.location.href = "${loginPage}"; }
el('btnConnect').addEventListener('click', handleConnect);
el('goLogin').addEventListener('click', ()=> window.location.href = "${loginPage}");
el('copyIP').addEventListener('click', ()=> { navigator.clipboard.writeText('craftpick.fr'); showNotify('IP copiée !'); });

// menu buttons -> redirect to login page if not logged, otherwise simulate
el('navHome').addEventListener('click', ()=> guardOrRedirect('Accueil'));
el('navGames').addEventListener('click', ()=> guardOrRedirect('Mini-Jeux'));
el('navVote').addEventListener('click', ()=> guardOrRedirect('Vote'));
el('navShop').addEventListener('click', ()=> guardOrRedirect('Boutique'));

el('btnLobby').addEventListener('click', ()=> guardOrRedirect('Lobby'));
el('btnShop').addEventListener('click', ()=> guardOrRedirect('Boutique'));
el('btnVote').addEventListener('click', ()=> guardOrRedirect('Vote'));
el('btnRecruit').addEventListener('click', ()=> guardOrRedirect('Recrutement'));

// init
renderArenas(); updateStatus(); updateStats(); renderLogged();
setInterval(updateStatus,7000); setInterval(updateStats,15000);
</script>
</body>
</html>
